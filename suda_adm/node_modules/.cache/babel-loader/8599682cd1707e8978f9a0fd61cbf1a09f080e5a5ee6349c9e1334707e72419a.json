{"ast":null,"code":"export default {\n  name: \"MoviePlan\",\n  data() {\n    // 售价自定义校验规则\n    let checkPrice = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"售价不能为空\"));\n      } else {\n        if (/^(0(?!\\.00)|[1-9]\\d{0,6})\\.\\d{2}$/.test(value)) {\n          callback();\n        } else {\n          callback(new Error(\"请输入正确格式的售价\"));\n        }\n      }\n    };\n    return {\n      currentPage: 1,\n      // 当前页码\n      total: 0,\n      // 总条数\n      pageSize: 5,\n      // 每页的数据条数\n      // 对话框显示标题\n      dialogTitle: \"\",\n      // 对话框显示状态\n      dialogFormVisible: false,\n      // 添加或编辑排片信息\n      planInfo: {\n        name: \"\",\n        movieId: \"\",\n        cinema: \"\",\n        hall: \"\",\n        inDate: \"\",\n        outDate: \"\",\n        outTime: \"\",\n        leaveTime: \"\",\n        sale: \"\"\n      },\n      // 排片列表数据\n      planList: [],\n      // 影院列表数据\n      cinemaList: [],\n      // 电影列表数据\n      movieList: [],\n      // 影厅列表数据\n      hallList: [\"1号厅\", \"2号厅\", \"三号厅\", \"4号厅\", \"5号厅\"],\n      // 放映时间选项\n      outTimeOptions: [{\n        label: \"08:05\",\n        value: \"08:05\"\n      }, {\n        label: \"12:05\",\n        value: \"12:05\"\n      }, {\n        label: \"16:05\",\n        value: \"16:05\"\n      }, {\n        label: \"20:05\",\n        value: \"20:05\"\n      }],\n      // 散场时间选项\n      leaveTimeOptions: [{\n        label: \"11:05\",\n        value: \"11:05\"\n      }, {\n        label: \"12:05\",\n        value: \"12:05\"\n      }, {\n        label: \"15:05\",\n        value: \"15:05\"\n      }, {\n        label: \"16:05\",\n        value: \"16:05\"\n      }, {\n        label: \"23:05\",\n        value: \"23:05\"\n      }, {\n        label: \"00:05\",\n        value: \"00:05\"\n      }],\n      // 放映日期设置时间只能往后选，之前的禁用\n      datePickerOptions: {\n        disabledDate: this.disabledDate\n      },\n      // 表单验证规则\n      planInfoFormrules: {\n        name: [{\n          required: true,\n          message: \"电影名不能为空\",\n          trigger: \"change\"\n        }],\n        cinema: [{\n          required: true,\n          message: \"影院名不能为空\",\n          trigger: \"change\"\n        }],\n        hall: [{\n          required: true,\n          message: \"影厅名不能为空\",\n          trigger: \"change\"\n        }],\n        outDate: [{\n          required: true,\n          message: \"放映日期不能为空\",\n          trigger: \"change\"\n        }],\n        outTime: [{\n          required: true,\n          message: \"放映时间不能为空\",\n          trigger: \"change\"\n        }],\n        sale: [{\n          required: true,\n          validator: checkPrice,\n          trigger: \"blur\"\n        }]\n      },\n      // 搜索框内容\n      searchContent: \"\"\n    };\n  },\n  methods: {\n    //限制可选日期\n    disabledDate(time) {\n      let curDate = new Date().getTime();\n      const two = 2 * 24 * 60 * 60 * 1000;\n      const twoDays = curDate + two;\n      return time.getTime() < Date.now() || time.getTime() > twoDays; //小于当前的禁止，大于2天前的禁止\n    },\n\n    // 获取影院列表\n\n    // 获取电影列表\n    async movieFetch() {\n      const res = await this.$http.get('/movie');\n      this.movieList = res.data;\n    },\n    // 获取选中的电影数据，从而取出对应电影上映时间数据\n\n    // 获取选中的影院数据，从而取出影厅数据\n\n    // 获取排片列表\n\n    // 添加排片\n    addPlan() {\n      // 清空排片列表\n      this.planInfo = {};\n      this.dialogTitle = \"添加排片\";\n      this.dialogFormVisible = true;\n    },\n    // 确定对话框\n\n    // 取消对话框\n    cancel() {\n      // console.log(this.planInfo);\n      this.dialogFormVisible = false;\n      // 清空planInfo数据\n      this.planInfo = {};\n    },\n    // 编辑排片\n\n    // 撤销电影\n\n    // 分页器当前页面变动时触发\n\n    // 搜索框搜索\n    //每页条数改变时触发 选择一页显示多少行\n    handleSizeChange(val) {\n      console.log(`每页 ${val} 条`);\n      this.currentPage = 1;\n      this.pageSize = val;\n    },\n    //当前页改变时触发 跳转其他页\n    handleCurrentChange(val) {\n      console.log(`当前页: ${val}`);\n      this.currentPage = val;\n    }\n  },\n  created() {\n    // 获取排片列表\n    // this.getPlanList();\n    // 获取影院列表\n    // this.getCinemaList();\n    // 获取电影列表\n    this.movieFetch();\n  }\n};","map":{"version":3,"mappings":"AAoOA;EACAA;EACAC;IACA;IACA;MACA;QACAC;MACA;QACA;UACAA;QACA;UACAA;QACA;MACA;IACA;IACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACA;MACAC;MACA;MACAC;MACA;MACAC;QACAR;QACAS;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC,iBACA;QAAAC;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACA;MACAC,mBACA;QAAAF;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACA;MACAE;QACAC;MACA;MACA;MACAC;QACA3B,OACA;UAAA4B;UAAAC;UAAAC;QAAA,EACA;QACApB,SACA;UAAAkB;UAAAC;UAAAC;QAAA,EACA;QACAnB,OACA;UAAAiB;UAAAC;UAAAC;QAAA,EACA;QACAjB,UACA;UAAAe;UAAAC;UAAAC;QAAA,EACA;QACAhB,UACA;UAAAc;UAAAC;UAAAC;QAAA,EACA;QACAd;UAAAY;UAAAG;UAAAD;QAAA;MACA;MACA;MACAE;IACA;EACA;EACAC;IACA;IACAP;MACA;MACA;MACA;MACA;IACA;;IACA;;IAEA;IACA;MACA;MACA;IACA;IACA;;IAEA;;IAEA;;IAEA;IACAQ;MACA;MACA;MACA;MACA;IACA;IACA;;IAEA;IACAC;MACA;MACA;MACA;MACA;IACA;IACA;;IAEA;;IAEA;;IAGA;IACA;IACAC;MACAC;MACA;MACA;IACA;IACA;IACAC;MACAD;MACA;IACA;EAEA;EACAE;IACA;IACA;IACA;IACA;IACA;IACA;EACA;AACA","names":["name","data","callback","currentPage","total","pageSize","dialogTitle","dialogFormVisible","planInfo","movieId","cinema","hall","inDate","outDate","outTime","leaveTime","sale","planList","cinemaList","movieList","hallList","outTimeOptions","label","value","leaveTimeOptions","datePickerOptions","disabledDate","planInfoFormrules","required","message","trigger","validator","searchContent","methods","addPlan","cancel","handleSizeChange","console","handleCurrentChange","created"],"sourceRoot":"src/views/Home","sources":["MoviePlan.vue"],"sourcesContent":["<template>\n  <div class=\"PlanManage\">\n    <!--搜索-->\n    <div class=\"top\">\n      <el-input placeholder=\"请输入内容\" class=\"input-with-select\" style=\"width: 30%\">\n        <template v-slot:append>\n          <el-button icon=\"el-icon-search\">搜索</el-button>\n        </template>\n      </el-input>\n      <el-button type=\"primary\" size=\"small\" @click=\"addPlan\" style=\"margin-left: 15px;\">\n        安排电影\n      </el-button>\n    </div>\n    <!-- 表格 -->\n    <div class=\"plan-table\">\n      <el-table border :data=\"planList.slice((currentPage-1)*pageSize,currentPage*pageSize)\">\n        <el-table-column\n          label=\"电影名\"\n          show-overflow-tooltip\n          prop=\"name\"\n        ></el-table-column>\n<!--        <el-table-column-->\n<!--          label=\"影院名\"-->\n<!--          width=\"150\"-->\n<!--          prop=\"cinema.name\"-->\n<!--          show-overflow-tooltip-->\n<!--        ></el-table-column>-->\n        <el-table-column\n          label=\"放映大厅\"\n          show-overflow-tooltip\n          prop=\"hall.name\"\n        ></el-table-column>\n        <el-table-column\n          label=\"放映日期\"\n          show-overflow-tooltip\n          prop=\"outDate\"\n        ></el-table-column>\n        <el-table-column\n          label=\"放映时间\"\n          show-overflow-tooltip\n          prop=\"outTime\"\n        ></el-table-column>\n        <el-table-column\n          label=\"售价(元)\"\n          show-overflow-tooltip\n          prop=\"sale\"\n        ></el-table-column>\n        <el-table-column align=\"center\" width=\"150\" label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" @click=\"handleEdit(scope.row)\"\n              >编辑</el-button\n            >\n            <el-button\n              size=\"mini\"\n              type=\"danger\"\n              @click=\"handleDelete(scope.row)\"\n              >撤销</el-button\n            >\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n    <!-- 分页器 -->\n    <el-pagination\n        align=\"center\"\n        small\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"currentPage\"\n        layout=\"total,sizes,prev,pager,next,jumper\"\n        :total=\"planList.length\"\n        :page-size=\"pageSize\"\n        :page-sizes=\"[1,5,10]\">\n    </el-pagination>\n    <!-- 添加或编辑排片对话框 -->\n    <div>\n      <el-dialog\n        :title=\"dialogTitle\"\n        :visible.sync=\"dialogFormVisible\"\n        :modal-append-to-body=\"false\"\n        v-if=\"dialogFormVisible\"\n        :showClose=\"false\"\n        :close-on-click-modal=\"false\"\n        top=\"5vh\"\n      >\n        <el-form\n          label-width=\"80px\"\n          :model=\"planInfo\"\n          :rules=\"planInfoFormrules\"\n          ref=\"planInfoForm\"\n        >\n          <el-form-item label=\"电影名\" prop=\"name\">\n            <el-col :span=\"16\">\n              <el-select\n                v-model=\"planInfo.name\"\n                clearable\n                placeholder=\"请选择电影名\"\n                style=\"width: 100%\"\n                @change=\"getInDateData\"\n              >\n                <el-option\n                  v-for=\"item in movieList\"\n                  :key=\"item._id\"\n                  :value=\"item.name\"\n                  :label=\"item.name\"\n                ></el-option>\n              </el-select>\n            </el-col>\n          </el-form-item>\n<!--          <el-form-item label=\"影院名\" prop=\"cinema\">-->\n<!--            <el-col :span=\"16\">-->\n<!--              <el-select-->\n<!--                v-model=\"planInfo.cinema\"-->\n<!--                clearable-->\n<!--                placeholder=\"请选择影院名\"-->\n<!--                style=\"width: 100%\"-->\n<!--                @change=\"getHallList\"-->\n<!--              >-->\n<!--                <el-option-->\n<!--                  v-for=\"item in cinemaList\"-->\n<!--                  :key=\"item._id\"-->\n<!--                  :value=\"item._id\"-->\n<!--                  :label=\"item.name\"-->\n<!--                ></el-option>-->\n<!--              </el-select>-->\n<!--            </el-col>-->\n<!--          </el-form-item>-->\n          <el-form-item label=\"影厅名\" prop=\"hall\">\n            <el-col :span=\"16\">\n              <el-select\n                v-model=\"planInfo.hall\"\n                clearable\n                placeholder=\"请选择影厅名\"\n                style=\"width: 100%\"\n              >\n                <el-option\n                  v-for=\"item in hallList\"\n                  :key=\"item._id\"\n                  :value=\"item._id\"\n                  :label=\"item.name\"\n                ></el-option>\n              </el-select>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"放映时间\" prop=\"outTime\">\n            <el-col :span=\"16\">\n              <el-select\n                v-model=\"planInfo.outTime\"\n                clearable\n                placeholder=\"请选择放映时间\"\n                style=\"width: 100%\"\n              >\n                <el-option\n                  v-for=\"item in outTimeOptions\"\n                  :key=\"item.value\"\n                  :value=\"item.value\"\n                  :label=\"item.label\"\n                ></el-option>\n              </el-select>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"散场时间\" prop=\"outTime\">\n            <el-col :span=\"16\">\n              <el-select\n                v-model=\"planInfo.leaveTime\"\n                clearable\n                placeholder=\"请选择放映时间\"\n                style=\"width: 100%\"\n              >\n                <el-option\n                  v-for=\"item in leaveTimeOptions\"\n                  :key=\"item.value\"\n                  :value=\"item.value\"\n                  :label=\"item.label\"\n                ></el-option>\n              </el-select>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"上映日期\" prop=\"inDate\">\n            <el-col :span=\"16\">\n              <el-date-picker\n                  v-model=\"planInfo.inDate\"\n                  type=\"date\"\n                  placeholder=\"选择日期\"\n                  style=\"width: 100%\">\n              </el-date-picker>\n<!--              <el-date-picker-->\n<!--                v-model=\"planInfo.inDate\"-->\n<!--                readonly-->\n<!--                type=\"date\"-->\n<!--                value-format=\"yyyy-MM-dd\"-->\n<!--                style=\"width: 100%\"-->\n<!--              >-->\n<!--              </el-date-picker>-->\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"放映日期\" prop=\"outDate\">\n            <el-col :span=\"16\">\n              <el-date-picker\n                v-model=\"planInfo.outDate\"\n                type=\"date\"\n                value-format=\"yyyy-MM-dd\"\n                placeholder=\"选择日期\"\n                style=\"width: 100%\"\n                :picker-options=\"datePickerOptions\"\n              >\n              </el-date-picker>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"电影售价\" prop=\"sale\">\n            <el-col :span=\"16\">\n              <el-input\n                v-model=\"planInfo.sale\"\n                placeholder=\"请输入电影售价\"\n              ></el-input>\n            </el-col>\n          </el-form-item>\n        </el-form>\n        <div slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\" dialogFormVisible=false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"managePlanInfo\">确 定</el-button>\n        </div>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name:\"MoviePlan\",\n  data() {\n    // 售价自定义校验规则\n    let checkPrice = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"售价不能为空\"));\n      } else {\n        if (/^(0(?!\\.00)|[1-9]\\d{0,6})\\.\\d{2}$/.test(value)) {\n          callback();\n        } else {\n          callback(new Error(\"请输入正确格式的售价\"));\n        }\n      }\n    };\n    return {\n      currentPage: 1, // 当前页码\n      total: 0, // 总条数\n      pageSize: 5,// 每页的数据条数\n      // 对话框显示标题\n      dialogTitle: \"\",\n      // 对话框显示状态\n      dialogFormVisible: false,\n      // 添加或编辑排片信息\n      planInfo: {\n        name: \"\",\n        movieId: \"\",\n        cinema: \"\",\n        hall: \"\",\n        inDate: \"\",\n        outDate: \"\",\n        outTime: \"\",\n        leaveTime: \"\",\n        sale: \"\",\n      },\n      // 排片列表数据\n      planList: [],\n      // 影院列表数据\n      cinemaList: [],\n      // 电影列表数据\n      movieList: [],\n      // 影厅列表数据\n      hallList: [\"1号厅\",\"2号厅\",\"三号厅\",\"4号厅\",\"5号厅\"],\n      // 放映时间选项\n      outTimeOptions: [\n        { label: \"08:05\", value: \"08:05\" },\n        { label: \"12:05\", value: \"12:05\" },\n        { label: \"16:05\", value: \"16:05\" },\n        { label: \"20:05\", value: \"20:05\" },\n      ],\n      // 散场时间选项\n      leaveTimeOptions: [\n        { label: \"11:05\", value: \"11:05\" },\n        { label: \"12:05\", value: \"12:05\" },\n        { label: \"15:05\", value: \"15:05\" },\n        { label: \"16:05\", value: \"16:05\" },\n        { label: \"23:05\", value: \"23:05\" },\n        { label: \"00:05\", value: \"00:05\" },\n      ],\n      // 放映日期设置时间只能往后选，之前的禁用\n      datePickerOptions: {\n        disabledDate: this.disabledDate,\n      },\n      // 表单验证规则\n      planInfoFormrules: {\n        name: [\n          { required: true, message: \"电影名不能为空\", trigger: \"change\" },\n        ],\n        cinema: [\n          { required: true, message: \"影院名不能为空\", trigger: \"change\" },\n        ],\n        hall: [\n          { required: true, message: \"影厅名不能为空\", trigger: \"change\" },\n        ],\n        outDate: [\n          { required: true, message: \"放映日期不能为空\", trigger: \"change\" },\n        ],\n        outTime: [\n          { required: true, message: \"放映时间不能为空\", trigger: \"change\" },\n        ],\n        sale: [{ required: true, validator: checkPrice, trigger: \"blur\" }],\n      },\n      // 搜索框内容\n      searchContent: \"\",\n    };\n  },\n  methods: {\n    //限制可选日期\n    disabledDate(time) {\n      let curDate = new Date().getTime();\n      const two = 2 * 24 * 60 * 60 * 1000;\n      const twoDays = curDate + two;\n      return time.getTime() < Date.now() || time.getTime() > twoDays; //小于当前的禁止，大于2天前的禁止\n    },\n    // 获取影院列表\n\n    // 获取电影列表\n    async movieFetch() {\n      const res = await this.$http.get('/movie')\n      this.movieList = res.data\n    },\n    // 获取选中的电影数据，从而取出对应电影上映时间数据\n\n    // 获取选中的影院数据，从而取出影厅数据\n\n    // 获取排片列表\n\n    // 添加排片\n    addPlan() {\n      // 清空排片列表\n      this.planInfo = {};\n      this.dialogTitle = \"添加排片\";\n      this.dialogFormVisible = true;\n    },\n    // 确定对话框\n\n    // 取消对话框\n    cancel() {\n      // console.log(this.planInfo);\n      this.dialogFormVisible = false;\n      // 清空planInfo数据\n      this.planInfo = {};\n    },\n    // 编辑排片\n\n    // 撤销电影\n\n    // 分页器当前页面变动时触发\n\n\n    // 搜索框搜索\n    //每页条数改变时触发 选择一页显示多少行\n    handleSizeChange(val) {\n      console.log(`每页 ${val} 条`);\n      this.currentPage = 1;\n      this.pageSize = val;\n    },\n    //当前页改变时触发 跳转其他页\n    handleCurrentChange(val) {\n      console.log(`当前页: ${val}`);\n      this.currentPage = val;\n    },\n\n  },\n  created() {\n    // 获取排片列表\n    // this.getPlanList();\n    // 获取影院列表\n    // this.getCinemaList();\n    // 获取电影列表\n    this.movieFetch();\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.top {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 30px 0;\n  margin-bottom: 30px;\n}\n\n.adPlan {\n  width: 90%;\n  min-width: 900px;\n  margin: 0 auto 30px;\n}\n// 海报图片样式\n.avatar-uploader-icon {\n  width: 276px;\n  height: 92px;\n  line-height: 92px;\n}\n.avatar {\n  width: 276px;\n  height: 92px;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}