{"ast":null,"code":"export default {\n  name: \"MoviePlan\",\n  data() {\n    return {\n      currentPage: 1,\n      // 当前页码\n      total: 0,\n      // 总条数\n      pageSize: 5,\n      // 每页的数据条数\n      // 对话框显示标题\n      dialogTitle: \"\",\n      // 对话框显示状态\n      dialogFormVisible: false,\n      // 添加或编辑排片信息\n      planInfo: {\n        name: \"\",\n        movieId: \"\",\n        cinema: \"\",\n        hall: \"\",\n        inDate: \"\",\n        outDate: \"\",\n        inTime: \"\",\n        leaveTime: \"\",\n        price: \"\"\n      },\n      // 排片列表数据\n      planList: [],\n      // 电影列表数据\n      movieList: [],\n      // 影厅列表数据\n      hallList: [{\n        label: \"1号厅\",\n        value: \"1号厅\"\n      }, {\n        label: \"2号厅\",\n        value: \"2号厅\"\n      }, {\n        label: \"3号厅\",\n        value: \"3号厅\"\n      }, {\n        label: \"4号厅\",\n        value: \"4号厅\"\n      }, {\n        label: \"5号厅\",\n        value: \"5号厅\"\n      }],\n      // 放映日期设置时间只能往后选，之前的禁用\n      datePickerOptions: {\n        disabledDate: this.disabledDate\n      },\n      // // 表单验证规则\n      // planInfoFormrules: {\n      //   name: [\n      //     {required: true, message: \"电影名不能为空\", trigger: \"change\"},\n      //   ],\n      //   cinema: [\n      //     {required: true, message: \"影院名不能为空\", trigger: \"change\"},\n      //   ],\n      //   hall: [\n      //     {required: true, message: \"影厅名不能为空\", trigger: \"change\"},\n      //   ],\n      //   outDate: [\n      //     {required: true, message: \"放映日期不能为空\", trigger: \"change\"},\n      //   ],\n      //   outTime: [\n      //     {required: true, message: \"放映时间不能为空\", trigger: \"change\"},\n      //   ],\n      //   // sale: [{ required: true, validator: checkPrice, trigger: \"blur\" }],\n      // },\n      // 搜索框内容\n      searchContent: \"\"\n    };\n  },\n  methods: {\n    //限制可选日期\n    disabledDate(time) {\n      let curDate = new Date().getTime();\n      const two = 2 * 24 * 60 * 60 * 1000;\n      const twoDays = curDate + two;\n      return time.getTime() < Date.now() || time.getTime() > twoDays; //小于当前的禁止，大于2天前的禁止\n    },\n\n    // 获取电影列表\n    async movieFetch() {\n      const res = await this.$http.get('/movie');\n      this.movieList = res.data;\n    },\n    // 获取选中的电影数据，从而取出对应电影上映时间数据\n\n    // 获取选中的影院数据，从而取出影厅数据\n\n    // 获取排片列表\n    async fetch() {\n      const res = await this.$http.get('/plan');\n      this.planList = res.data;\n    },\n    // 添加排片\n    addPlan() {\n      // 清空排片列表\n      this.planInfo = {};\n      this.dialogTitle = \"添加排片\";\n      this.dialogFormVisible = true;\n    },\n    // 排片确认\n    async planSave() {\n      //http://localhost:3000/admin/api/\n      const res = await this.$http.post('/plan', this.planInfo); // eslint-disable-line no-unused-vars\n      this.$message({\n        type: 'success',\n        message: '添加成功'\n      });\n      await this.$router.go(0);\n      this.dialogFormVisible = false;\n    },\n    // 取消对话框\n    cancel() {\n      // console.log(this.planInfo);\n      this.dialogFormVisible = false;\n      // 清空planInfo数据\n      this.planInfo = {};\n    },\n    // 编辑排片\n    planEdit(index, row) {\n      this.dialogTitle = \"编辑排片\";\n      // 这里拿到的row直接赋值是浅拷贝，JSON赋值是深拷贝\n      // 如果浅拷贝，Bug：点击编辑出现对话框修改数据，点击取消列表数据会变\n      // 但其实并没发请求，刷新后又变回原样\n      this.planInfo = row;\n      // 这里因为影厅数据是从hallList里面取的，而hallList的数据是根据cinema选择器选中后触发getHallList函数取到值来决定，这里直接赋值不会触发该函数，所以要手动触发\n      this.planInfo.movieId = this.planInfo._id;\n      this.dialogFormVisible = true;\n    },\n    // 撤销电影\n    async planDelete(index, row) {\n      this.$confirm(`此操作将撤销上映电影\"${row.name}\", 是否继续?`, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        const res = await this.$http.delete(`/plan`, {\n          data: {\n            _id: row._id\n          }\n        }); // eslint-disable-line no-unused-vars\n        this.$message({\n          type: 'success',\n          message: '撤销成功!'\n        });\n        await this.$router.go(0);\n      });\n    },\n    // 分页器当前页面变动时触发\n\n    // 搜索框搜索\n    //每页条数改变时触发 选择一页显示多少行\n    handleSizeChange(val) {\n      console.log(`每页 ${val} 条`);\n      this.currentPage = 1;\n      this.pageSize = val;\n    },\n    //当前页改变时触发 跳转其他页\n    handleCurrentChange(val) {\n      console.log(`当前页: ${val}`);\n      this.currentPage = val;\n    }\n  },\n  created() {\n    // 获取排片列表\n    this.fetch();\n    // 获取电影列表\n    this.movieFetch();\n  }\n};","map":{"version":3,"mappings":"AAqMA;EACAA;EACAC;IACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACA;MACAC;MACA;MACAC;MACA;MACAC;QACAP;QACAQ;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;MACAC;MACA;MACAC;MACA;MACAC,WACA;QAAAC;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACA;MACAC;QACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC;IACA;EACA;EACAC;IACA;IACAF;MACA;MACA;MACA;MACA;IACA;;IACA;IACA;MACA;MACA;IACA;IACA;;IAEA;;IAEA;IACA;MACA;MACA;IACA;IACA;IACAG;MACA;MACA;MACA;MACA;IACA;IACA;IACA;MACA;MACA;MACA;QACAC;QACAC;MACA;MACA;MACA;IAEA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA;IACA;MACA;QACAC;QACAC;QACAL;MACA;QACA;UAAAzB;YAAA+B;UAAA;QAAA;QACA;UACAN;UACAC;QACA;QACA;MACA;IACA;IACA;;IAGA;IACA;IACAM;MACAC;MACA;MACA;IACA;IACA;IACAC;MACAD;MACA;IACA;EAEA;EACAE;IACA;IACA;IACA;IACA;EACA;AACA","names":["name","data","currentPage","total","pageSize","dialogTitle","dialogFormVisible","planInfo","movieId","cinema","hall","inDate","outDate","inTime","leaveTime","price","planList","movieList","hallList","label","value","datePickerOptions","disabledDate","searchContent","methods","addPlan","type","message","cancel","planEdit","confirmButtonText","cancelButtonText","_id","handleSizeChange","console","handleCurrentChange","created"],"sourceRoot":"src/views/Home","sources":["MoviePlan.vue"],"sourcesContent":["<template>\n  <div class=\"PlanManage\">\n    <!--搜索-->\n    <div class=\"top\">\n      <el-input placeholder=\"请输入内容\" class=\"input-with-select\" style=\"width: 30%\">\n        <template v-slot:append>\n          <el-button icon=\"el-icon-search\">搜索</el-button>\n        </template>\n      </el-input>\n      <el-button type=\"primary\" size=\"small\" @click=\"addPlan\" style=\"margin-left: 15px;\">\n        安排电影\n      </el-button>\n    </div>\n    <!-- 表格 -->\n    <div class=\"plan-table\">\n      <el-table border :data=\"planList.slice((currentPage-1)*pageSize,currentPage*pageSize)\">\n        <el-table-column\n            label=\"电影名\"\n            show-overflow-tooltip\n            prop=\"name\"\n        ></el-table-column>\n        <el-table-column\n            label=\"放映大厅\"\n            show-overflow-tooltip\n            prop=\"hall\"\n        ></el-table-column>\n        <el-table-column\n            label=\"放映日期\"\n            show-overflow-tooltip\n            prop=\"outDate\"\n        ></el-table-column>\n        <el-table-column\n            label=\"放映时间\"\n            show-overflow-tooltip\n            prop=\"inTime\"\n        ></el-table-column>\n        <el-table-column\n            label=\"售价(元)\"\n            show-overflow-tooltip\n            prop=\"price\"\n        ></el-table-column>\n        <el-table-column align=\"center\" width=\"150\" label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" @click=\"planEdit(scope.$index,scope.row)\"\n            >编辑\n            </el-button\n            >\n            <el-button\n                size=\"mini\"\n                type=\"danger\"\n                @click=\"planDelete(scope.$index,scope.row)\"\n            >撤销\n            </el-button\n            >\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n    <!-- 分页器 -->\n    <el-pagination\n        align=\"center\"\n        small\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"currentPage\"\n        layout=\"total,sizes,prev,pager,next,jumper\"\n        :total=\"planList.length\"\n        :page-size=\"pageSize\"\n        :page-sizes=\"[1,5,10]\">\n    </el-pagination>\n    <!-- 添加或编辑排片对话框 -->\n    <div>\n      <el-dialog\n          :title=\"dialogTitle\"\n          :visible.sync=\"dialogFormVisible\"\n          :modal-append-to-body=\"false\"\n          v-if=\"dialogFormVisible\"\n          :showClose=\"false\"\n          :close-on-click-modal=\"false\"\n          top=\"5vh\"\n      >\n        <el-form\n            label-width=\"80px\"\n            :model=\"planInfo\"\n            ref=\"planInfoForm\"\n        >\n<!--            :rules=\"planInfoFormrules\"-->\n\n          <el-form-item label=\"电影名\" prop=\"name\">\n            <el-col :span=\"16\">\n              <el-select\n                  v-model=\"planInfo.name\"\n                  clearable\n                  placeholder=\"请选择电影名\"\n                  style=\"width: 100%\"\n                  @change=\"getInDateData\"\n              >\n                <el-option\n                    v-for=\"item in movieList\"\n                    :key=\"item._id\"\n                    :value=\"item.name\"\n                    :label=\"item.name\"\n                ></el-option>\n              </el-select>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"影厅名\" prop=\"hall\">\n            <el-col :span=\"16\">\n              <el-select\n                  v-model=\"planInfo.hall\"\n                  clearable\n                  placeholder=\"请选择影厅名\"\n                  style=\"width: 100%\"\n              >\n                <el-option\n                    v-for=\"item in hallList\"\n                    :key=\"item.value\"\n                    :label=\"item.label\"\n                    :value=\"item.value\"\n                ></el-option>\n              </el-select>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"放映时间\" prop=\"outTime\">\n            <el-col :span=\"16\">\n              <el-time-picker\n                  v-model=\"planInfo.inTime\"\n                  placeholder=\"请选择放映时间\"\n                  style=\"width: 100%\"\n                  format=\"HH:mm\"\n                  value-format=\"HH:mm\">\n\n              </el-time-picker>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"散场时间\" prop=\"leaveTime\">\n            <el-col :span=\"16\">\n              <el-time-picker\n                  v-model=\"planInfo.leaveTime\"\n                  placeholder=\"请选择结束时间\"\n                  style=\"width: 100%\"\n                  format=\"HH:mm\"\n                  value-format=\"HH:mm\">\n              </el-time-picker>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"上映日期\" prop=\"inDate\">\n            <el-col :span=\"16\">\n              <el-date-picker\n                  v-model=\"planInfo.inDate\"\n                  type=\"date\"\n                  value-format=\"yyyy-MM-dd\"\n                  placeholder=\"选择日期\"\n                  style=\"width: 100%\">\n              </el-date-picker>\n              <!--              <el-date-picker-->\n              <!--                v-model=\"planInfo.inDate\"-->\n              <!--                readonly-->\n              <!--                type=\"date\"-->\n              <!--                value-format=\"yyyy-MM-dd\"-->\n              <!--                style=\"width: 100%\"-->\n              <!--              >-->\n              <!--              </el-date-picker>-->\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"放映日期\" prop=\"outDate\">\n            <el-col :span=\"16\">\n              <el-date-picker\n                  v-model=\"planInfo.outDate\"\n                  type=\"date\"\n                  value-format=\"yyyy-MM-dd\"\n                  placeholder=\"选择日期\"\n                  style=\"width: 100%\"\n                  :picker-options=\"datePickerOptions\"\n              >\n              </el-date-picker>\n            </el-col>\n          </el-form-item>\n          <el-form-item label=\"电影售价\" prop=\"sale\">\n            <el-col :span=\"16\">\n              <el-input\n                  v-model=\"planInfo.price\"\n                  placeholder=\"请输入电影售价\"\n              ></el-input>\n            </el-col>\n          </el-form-item>\n        </el-form>\n        <div slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\"cancel\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"planSave\">确 定</el-button>\n        </div>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"MoviePlan\",\n  data() {\n    return {\n      currentPage: 1, // 当前页码\n      total: 0, // 总条数\n      pageSize: 5,// 每页的数据条数\n      // 对话框显示标题\n      dialogTitle: \"\",\n      // 对话框显示状态\n      dialogFormVisible: false,\n      // 添加或编辑排片信息\n      planInfo: {\n        name: \"\",\n        movieId: \"\",\n        cinema: \"\",\n        hall: \"\",\n        inDate: \"\",\n        outDate: \"\",\n        inTime: \"\",\n        leaveTime: \"\",\n        price: \"\",\n      },\n      // 排片列表数据\n      planList: [],\n      // 电影列表数据\n      movieList: [],\n      // 影厅列表数据\n      hallList: [\n        {label: \"1号厅\", value: \"1号厅\"},\n        {label: \"2号厅\", value: \"2号厅\"},\n        {label: \"3号厅\", value: \"3号厅\"},\n        {label: \"4号厅\", value: \"4号厅\"},\n        {label: \"5号厅\", value: \"5号厅\"},\n      ],\n      // 放映日期设置时间只能往后选，之前的禁用\n      datePickerOptions: {\n        disabledDate: this.disabledDate,\n      },\n      // // 表单验证规则\n      // planInfoFormrules: {\n      //   name: [\n      //     {required: true, message: \"电影名不能为空\", trigger: \"change\"},\n      //   ],\n      //   cinema: [\n      //     {required: true, message: \"影院名不能为空\", trigger: \"change\"},\n      //   ],\n      //   hall: [\n      //     {required: true, message: \"影厅名不能为空\", trigger: \"change\"},\n      //   ],\n      //   outDate: [\n      //     {required: true, message: \"放映日期不能为空\", trigger: \"change\"},\n      //   ],\n      //   outTime: [\n      //     {required: true, message: \"放映时间不能为空\", trigger: \"change\"},\n      //   ],\n      //   // sale: [{ required: true, validator: checkPrice, trigger: \"blur\" }],\n      // },\n      // 搜索框内容\n      searchContent: \"\",\n    };\n  },\n  methods: {\n    //限制可选日期\n    disabledDate(time) {\n      let curDate = new Date().getTime();\n      const two = 2 * 24 * 60 * 60 * 1000;\n      const twoDays = curDate + two;\n      return time.getTime() < Date.now() || time.getTime() > twoDays; //小于当前的禁止，大于2天前的禁止\n    },\n    // 获取电影列表\n    async movieFetch() {\n      const res = await this.$http.get('/movie')\n      this.movieList = res.data\n    },\n    // 获取选中的电影数据，从而取出对应电影上映时间数据\n\n    // 获取选中的影院数据，从而取出影厅数据\n\n    // 获取排片列表\n    async fetch() {\n      const res = await this.$http.get('/plan')\n      this.planList = res.data\n    },\n    // 添加排片\n    addPlan() {\n      // 清空排片列表\n      this.planInfo = {};\n      this.dialogTitle = \"添加排片\";\n      this.dialogFormVisible = true;\n    },\n    // 排片确认\n    async planSave(){\n        //http://localhost:3000/admin/api/\n        const res = await this.$http.post('/plan', this.planInfo)// eslint-disable-line no-unused-vars\n        this.$message({\n          type: 'success',\n          message: '添加成功',\n        })\n        await this.$router.go(0)\n        this.dialogFormVisible = false;\n\n    },\n    // 取消对话框\n    cancel() {\n      // console.log(this.planInfo);\n      this.dialogFormVisible = false;\n      // 清空planInfo数据\n      this.planInfo = {};\n    },\n    // 编辑排片\n    planEdit(index,row){\n      this.dialogTitle = \"编辑排片\";\n      // 这里拿到的row直接赋值是浅拷贝，JSON赋值是深拷贝\n      // 如果浅拷贝，Bug：点击编辑出现对话框修改数据，点击取消列表数据会变\n      // 但其实并没发请求，刷新后又变回原样\n      this.planInfo = row\n      // 这里因为影厅数据是从hallList里面取的，而hallList的数据是根据cinema选择器选中后触发getHallList函数取到值来决定，这里直接赋值不会触发该函数，所以要手动触发\n      this.planInfo.movieId = this.planInfo._id;\n      this.dialogFormVisible = true;\n    },\n    // 撤销电影\n    async planDelete(index, row) {\n      this.$confirm(`此操作将撤销上映电影\"${row.name}\", 是否继续?`, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        const res = await this.$http.delete(`/plan`, {data: {_id: row._id}}) // eslint-disable-line no-unused-vars\n        this.$message({\n          type: 'success',\n          message: '撤销成功!'\n        });\n        await this.$router.go(0)\n      })\n    },\n    // 分页器当前页面变动时触发\n\n\n    // 搜索框搜索\n    //每页条数改变时触发 选择一页显示多少行\n    handleSizeChange(val) {\n      console.log(`每页 ${val} 条`);\n      this.currentPage = 1;\n      this.pageSize = val;\n    },\n    //当前页改变时触发 跳转其他页\n    handleCurrentChange(val) {\n      console.log(`当前页: ${val}`);\n      this.currentPage = val;\n    },\n\n  },\n  created() {\n    // 获取排片列表\n    this.fetch();\n    // 获取电影列表\n    this.movieFetch();\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.top {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 30px 0;\n  margin-bottom: 30px;\n}\n\n.adPlan {\n  width: 90%;\n  min-width: 900px;\n  margin: 0 auto 30px;\n}\n\n// 海报图片样式\n.avatar-uploader-icon {\n  width: 276px;\n  height: 92px;\n  line-height: 92px;\n}\n\n.avatar {\n  width: 276px;\n  height: 92px;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}