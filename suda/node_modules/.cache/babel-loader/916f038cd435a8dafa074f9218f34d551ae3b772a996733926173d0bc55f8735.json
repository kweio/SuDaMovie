{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport TopBar from \"@/components/TopBar.vue\";\nexport default {\n  data() {\n    return {\n      planId: \"\",\n      //排片id\n      movieData: \"\",\n      //用于添加订单的数据，就是确认选座\n      model: {\n        hall: \"\",\n        //影院名\n        userId: \"\",\n        //用户id\n        seatInfo: [],\n        //选中座位坐标存储\n        ticketNum: 0,\n        //购票数量\n        totalPrice: 0,\n        //购票总价格\n        orderDate: \"\",\n        //场次日期\n        orderTime: \"\",\n        //场次时间\n        movieId: \"\",\n        hallId: \"\"\n      },\n      planData: {},\n      //排片数据\n      seatIJ: [[0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0]],\n      //座位数据\n      hackReset: true //座位dom显示状态\n    };\n  },\n\n  components: {\n    TopBar\n  },\n  methods: {\n    // 顶部返回按钮点击触发\n    backIconClick() {\n      this.$router.back();\n    },\n    // 获取排片数据\n    async getPlanData() {\n      const {\n        data: {\n          planData\n        }\n      } = await this.$http.get(`/plan/${this.planId}`);\n      this.planData = JSON.parse(JSON.stringify(planData));\n      this.movieData = planData.movieId;\n      this.movieData.category = this.movieData.category.toString();\n      // console.log(this.movieData.category)\n      // 将已经被定的座位设置为不可选\n      // this.planData.seatInfo.map((item) => {\n      //   this.seatIJ[item[0]][item[1]] = 2;\n      // });\n      // console.log(\"排片数据\", this.planData);\n    },\n\n    // 选中座位时触发\n    // 这里要注意的是，你虽然改变了数据，但是座位那里的v-for循环后的dom还是旧的，数据虽然变了但他不会重新渲染，所以我们定义一个状态变量，在我们去修改数据时，让它的dom元素从页面剔除，在vue 的生命钩子beforeUpdate或者updated中让状态变量取true让它重新渲染出来~\n    seatSelected(i, j) {\n      // 先判断座位是否为不可选中状态\n      console.log(i, j);\n      if (this.seatIJ[i][j] === 2) {\n        return this.$dialog.alert({\n          title: \"提示\",\n          message: \"该座位已被预订，请选择其他座位\",\n          theme: \"round-button\"\n        });\n      }\n      // 判断座位选中个数是否超额(这里限额6个)\n      if (this.seatIJ[i][j] === 0 && this.model.ticketNum === 6) {\n        return this.$dialog.alert({\n          title: \"提示\",\n          message: \"最多只能预定6个座位~\",\n          theme: \"round-button\"\n        });\n      }\n      if (this.seatIJ[i][j] === 0) {\n        this.seatIJ[i][j] = 1;\n        this.model.seatInfo.push([i, j]);\n        this.model.ticketNum += 1;\n      } else if (this.seatIJ[i][j] === 1) {\n        this.seatIJ[i][j] = 0;\n        const index = this.model.seatInfo.findIndex(item => {\n          return item[0] === i && item[1] === j;\n        });\n        this.model.seatInfo.splice(index, 1);\n        this.model.ticketNum -= 1;\n      }\n      this.hackReset = false;\n      this.$nextTick(() => {\n        this.hackReset = true;\n      });\n      // console.log(this.model.seatInfo);\n    }\n    // 点击确认选座按钮触发\n    // async confirmBtnClick() {\n    //   if (!this.model.seatInfo.length) {\n    //     return this.$dialog.alert({\n    //       title: \"提示\",\n    //       message: \"请先选座~\",\n    //       theme: \"round-button\",\n    //     });\n    //   }\n    //   this.model.name = this.planData.cinema.name;\n    //   this.model.planId = this.planId;\n    //   this.model.movieId = this.planData.movieId._id;\n    //   this.model.hallId = this.planData.hall._id;\n    //   this.model.cinemaId = this.planData.cinema._id;\n    //   this.model.totalPrice = (\n    //       this.planData.sale * this.model.ticketNum\n    //   ).toFixed(2);\n    //   this.model.ticketPrice = this.planData.sale;\n    //   this.model.orderDate = this.planData.outDate;\n    //   this.model.orderTime = this.planData.outTime;\n    //   // 发送请求添加订单\n    //   const { data } = await this.$http.post(`/addOrder`, this.model);\n    //   // console.log(data);\n    //   if (data.status == \"Ok\") {\n    //     this.$toast({\n    //       type: \"success\",\n    //       message: \"锁定座位成功\",\n    //     });\n    //     this.$router.push({\n    //       path: \"/orderSubmit\",\n    //       query: {\n    //         orderId: data.data._id,\n    //       },\n    //     });\n    //   }\n    // },\n  },\n\n  created() {\n    this.planId = this.$route.query.planId;\n    this.model.userId = window.localStorage.getItem(\"userId\");\n    this.getPlanData();\n  }\n};","map":{"version":3,"mappings":";AAqHA;AAEA;EACAA;IACA;MACAC;MAAA;MACAC;MACA;MACAC;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QACAC;MACA;MACAC;MAAA;MACAC,SACA,0BACA,0BACA,0BACA,0BACA,0BACA,yBACA;MAAA;MACAC;IACA;EACA;;EACAC;IACAC;EACA;EACAC;IACA;IACAC;MACA;IACA;IACA;IACA;MACA;QACAnB;UAAAa;QAAA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;;IACA;IACA;IACAO;MACA;MACAC;MACA;QACA;UACAC;UACAC;UACAC;QACA;MACA;MACA;MACA;QACA;UACAF;UACAC;UACAC;QACA;MACA;MACA;QACA;QACA;QACA;MACA;QACA;QACA;UACA;QACA;QACA;QACA;MACA;MACA;MACA;QACA;MACA;MACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;EACA;;EACAC;IACA;IACA;IACA;EACA;AACA","names":["data","planId","movieData","model","hall","userId","seatInfo","ticketNum","totalPrice","orderDate","orderTime","movieId","hallId","planData","seatIJ","hackReset","components","TopBar","methods","backIconClick","seatSelected","console","title","message","theme","created"],"sourceRoot":"src/views","sources":["SeatSelect.vue"],"sourcesContent":["<template>\n  <div class=\"wrap\">\n    <!-- 顶部topBar部分 -->\n    <TopBar\n        bgc=\"#fff\"\n        v-if=\"planData\"\n        @backIconClick=\"backIconClick\"\n        :centerContent=\"planData.hall\"\n    ></TopBar>\n\n    <!-- 电影选座区域 -->\n    <div class=\"seat-select\" v-if=\"planData\">\n      <div class=\"screen\">\n        <div class=\"screen-shape\">\n          <img src=\"@/assets/image/screen.png\"/>\n        </div>\n<!--        <div class=\"screen-name\">-->\n<!--          <span>{{ planData.hall }}</span>-->\n<!--        </div>-->\n      </div>\n      <div class=\"seat\">\n        <div class=\"left\">\n          <div>1</div>\n          <div>2</div>\n          <div>3</div>\n          <div>4</div>\n          <div>5</div>\n          <div>6</div>\n        </div>\n        <div class=\"right\" v-if=\"hackReset\">\n          <div class=\"row\" v-for=\"(itemI, indexI) in seatIJ\" :key=\"indexI\">\n            <div class=\"column\" v-for=\"(itemJ, indexJ) in itemI\" :key=\"indexJ\">\n              <span\n                  class=\"iconfont icon-zuowei1-copy-copy-copy \"\n                  :class=\"{\n                  selected: itemJ === 1,\n                  forbidSelected: itemJ === 2,\n                }\"\n                  @click.stop.prevent=\"seatSelected(indexI, indexJ)\"\n              ></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- 确认选座部分 -->\n    <div class=\"confirm-seat\" v-if=\"planData\">\n      <!-- 选座提示部分 -->\n      <div class=\"select-tip\">\n        <div class=\"select-tip-item\">\n          <span class=\"confirm-btn-active\"></span>\n          <div>可选</div>\n        </div>\n        <div class=\"select-tip-item\">\n          <span class=\"forbidSelected\"></span>\n          <div>不可选</div>\n        </div>\n        <div class=\"select-tip-item\">\n          <span class=\"selected\"></span>\n          <div>已选</div>\n        </div>\n      </div>\n      <!-- 确认信息部分 -->\n      <div class=\"confirm-content\">\n        <!-- 电影信息部分 -->\n        <div class=\"movie-info\">\n          <div class=\"movie-title\">\n            <span>{{ planData.name }}</span>\n          </div>\n          <div class=\"movie-content\">\n            <span>{{ planData.inDate }}</span>\n            <span>{{\n                planData.outDateMM + \"月\" + planData.outDateDD + \"日\"\n              }}</span>\n            <span>{{ planData.inTime + \"-\" + planData.leaveTime }}</span><br>\n            <span>\n              {{ movieData.language }}&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;\n              {{ movieData.category }}</span>\n          </div>\n        </div>\n        <!-- 选座信息部分 -->\n        <div class=\"seat-info-list\">\n          <div\n              class=\"seat-info-item\"\n              v-for=\"(item, index) in model.seatInfo\"\n              :key=\"index\"\n          >\n            <div class=\"seat-info-left\">\n              <div class=\"seat-info-title\">\n                {{ item[0] + 1 }}排{{ item[1] + 1 }}座\n              </div>\n              <div class=\"seat-info-price\">￥{{ planData.price }}</div>\n            </div>\n            <div\n                class=\"seat-info-right\"\n                @click.prevent.stop=\"seatSelected(item[0], item[1])\"\n            >\n\n              <van-icon name=\"cross\"/>\n            </div>\n          </div>\n        </div>\n      </div>\n      <!-- 确认选座按钮 -->\n      <div\n          class=\"confirm-btn\"\n          :class=\"{ 'confirm-btn-active': model.seatInfo.length !== 0 }\"\n          @click.stop.prevent=\"confirmBtnClick\"\n      >\n        <!--        @click.stop.prevent=\"confirmBtnClick\"-->\n        <span>确认选座</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport TopBar from \"@/components/TopBar.vue\";\n\nexport default {\n  data() {\n    return {\n      planId: \"\", //排片id\n      movieData: \"\",\n      //用于添加订单的数据，就是确认选座\n      model: {\n        hall: \"\", //影院名\n        userId: \"\", //用户id\n        seatInfo: [], //选中座位坐标存储\n        ticketNum: 0, //购票数量\n        totalPrice: 0, //购票总价格\n        orderDate: \"\", //场次日期\n        orderTime: \"\", //场次时间\n        movieId: \"\",\n        hallId: \"\",\n      },\n      planData: {}, //排片数据\n      seatIJ: [\n        [0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0],\n      ], //座位数据\n      hackReset: true, //座位dom显示状态\n    };\n  },\n  components: {\n    TopBar,\n  },\n  methods: {\n    // 顶部返回按钮点击触发\n    backIconClick() {\n      this.$router.back();\n    },\n    // 获取排片数据\n    async getPlanData() {\n      const {\n        data: {planData},\n      } = await this.$http.get(`/plan/${this.planId}`);\n      this.planData = JSON.parse(JSON.stringify(planData));\n      this.movieData = planData.movieId\n      this.movieData.category = this.movieData.category.toString()\n      // console.log(this.movieData.category)\n      // 将已经被定的座位设置为不可选\n      // this.planData.seatInfo.map((item) => {\n      //   this.seatIJ[item[0]][item[1]] = 2;\n      // });\n      // console.log(\"排片数据\", this.planData);\n    },\n    // 选中座位时触发\n    // 这里要注意的是，你虽然改变了数据，但是座位那里的v-for循环后的dom还是旧的，数据虽然变了但他不会重新渲染，所以我们定义一个状态变量，在我们去修改数据时，让它的dom元素从页面剔除，在vue 的生命钩子beforeUpdate或者updated中让状态变量取true让它重新渲染出来~\n    seatSelected(i, j) {\n      // 先判断座位是否为不可选中状态\n      console.log(i,j)\n      if (this.seatIJ[i][j] === 2) {\n        return this.$dialog.alert({\n          title: \"提示\",\n          message: \"该座位已被预订，请选择其他座位\",\n          theme: \"round-button\",\n        });\n      }\n      // 判断座位选中个数是否超额(这里限额6个)\n      if (this.seatIJ[i][j] === 0 && this.model.ticketNum === 6) {\n        return this.$dialog.alert({\n          title: \"提示\",\n          message: \"最多只能预定6个座位~\",\n          theme: \"round-button\",\n        });\n      }\n      if (this.seatIJ[i][j] === 0) {\n        this.seatIJ[i][j] = 1;\n        this.model.seatInfo.push([i, j]);\n        this.model.ticketNum += 1;\n      } else if (this.seatIJ[i][j] === 1) {\n        this.seatIJ[i][j] = 0;\n        const index = this.model.seatInfo.findIndex((item) => {\n          return item[0] === i && item[1] === j;\n        });\n        this.model.seatInfo.splice(index, 1);\n        this.model.ticketNum -= 1;\n      }\n      this.hackReset = false;\n      this.$nextTick(() => {\n        this.hackReset = true;\n      });\n      // console.log(this.model.seatInfo);\n    },\n    // 点击确认选座按钮触发\n    // async confirmBtnClick() {\n    //   if (!this.model.seatInfo.length) {\n    //     return this.$dialog.alert({\n    //       title: \"提示\",\n    //       message: \"请先选座~\",\n    //       theme: \"round-button\",\n    //     });\n    //   }\n    //   this.model.name = this.planData.cinema.name;\n    //   this.model.planId = this.planId;\n    //   this.model.movieId = this.planData.movieId._id;\n    //   this.model.hallId = this.planData.hall._id;\n    //   this.model.cinemaId = this.planData.cinema._id;\n    //   this.model.totalPrice = (\n    //       this.planData.sale * this.model.ticketNum\n    //   ).toFixed(2);\n    //   this.model.ticketPrice = this.planData.sale;\n    //   this.model.orderDate = this.planData.outDate;\n    //   this.model.orderTime = this.planData.outTime;\n    //   // 发送请求添加订单\n    //   const { data } = await this.$http.post(`/addOrder`, this.model);\n    //   // console.log(data);\n    //   if (data.status == \"Ok\") {\n    //     this.$toast({\n    //       type: \"success\",\n    //       message: \"锁定座位成功\",\n    //     });\n    //     this.$router.push({\n    //       path: \"/orderSubmit\",\n    //       query: {\n    //         orderId: data.data._id,\n    //       },\n    //     });\n    //   }\n    // },\n  },\n  created() {\n    this.planId = this.$route.query.planId;\n    this.model.userId = window.localStorage.getItem(\"userId\");\n    this.getPlanData();\n  },\n}\n</script>\n\n<style lang=\"less\" scoped>\n// 外部盒子部分\n.wrap {\n  width: 100vw;\n  height: 150%;\n  background-color: #f1f1f1;\n}\n// 电影选座区域\n.seat-select {\n  margin-top: 1.5385rem;\n  padding: 0.7692rem;\n  //height: 35rem;\n  .screen {\n    position: relative;\n    // 屏幕图片部分\n    .screen-shape {\n      img {\n        width: 100%;\n      }\n    }\n    .screen-name {\n      position: absolute;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      font-size: 1.0769rem;\n      color: #a7a9ae;\n    }\n  }\n  .seat {\n    display: flex;\n    justify-content: space-between;\n    .left {\n      text-align: center;\n      padding: 0.7692rem 0;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-around;\n      background-color: #b6b6b6;\n      border-radius: 20px;\n      width: 5%;\n      div {\n        color: #fff;\n        padding: 1.1538rem 0;\n      }\n    }\n    .right {\n      padding: 0.7692rem 0;\n      width: 90%;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-around;\n      .row {\n        display: flex;\n        justify-content: space-around;\n        align-items: center;\n        .column {\n          span {\n            width: 2rem;\n            height: 2rem;\n            display: inline-block;\n            font-size: 1.8462rem;\n            background-color: #fff;\n          }\n        }\n      }\n    }\n  }\n}\n// 确认选座部分\n.confirm-seat {\n  //margin-top: 10%;\n  //position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  padding: 0.7692rem;\n  // 选座提示部分\n  .select-tip {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 2.3077rem;\n    .select-tip-item {\n      color: #a7a9ae;\n      display: flex;\n      align-items: center;\n      margin: 0 0.7692rem;\n      span {\n        display: inline-block;\n        width: 2rem;\n        height: 2rem;\n        color: #fff;\n        font-size: 1.3846rem;\n        margin-right: 0.3846rem;\n      }\n    }\n  }\n  // 确认信息部分\n  .confirm-content {\n    width: 85vw;\n    text-align: left;\n    background-color: #fff;\n    margin: 0.7692rem auto;\n    border-radius: 10px;\n    padding: 0.7692rem;\n    // 电影信息部分\n    .movie-info {\n      margin: 0.7692rem 0;\n      .movie-title {\n        font-size: 1.2308rem;\n        margin-bottom: 0.7692rem;\n      }\n      .movie-content {\n        color: #a7a9ae;\n        span {\n          margin-right: 0.7692rem;\n        }\n      }\n    }\n    // 选座信息部分\n    .seat-info-list {\n      width: 100%;\n      display: flex;\n      overflow: scroll;\n      .seat-info-item {\n        flex-shrink: 0;\n        width: 30%;\n        margin-right: 5%;\n        padding: 0.7692rem;\n        border-radius: 0.3846rem;\n        background-color: rgb(233, 233, 233);\n        color: rgb(162, 162, 162);\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        .seat-info-left {\n          width: 100%;\n          .seat-info-title {\n            margin-bottom: 0.3846rem;\n          }\n        }\n      }\n    }\n  }\n  // 确认选座按钮\n  .confirm-btn {\n    color: #ffbb6f;\n    width: 85vw;\n    background-color: #fe9900;\n    padding: 0.7692rem;\n    border-radius: 1.5385rem;\n  }\n}\n// 已选座位样式\n.selected {\n  background-color: #6dbd00 !important;\n}\n// 不可选座位样式\n.forbidSelected {\n  background-color: #dd2724 !important;\n}\n// 确认选座按钮可选中样式\n.confirm-btn-active {\n  background-color: #fff !important;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}