{"ast":null,"code":"import TopBar from \"@/components/TopBar\";\nexport default {\n  name: \"order-pay\",\n  data() {\n    return {\n      // time: 3 * 1000,    //3秒测试用\n      time: 14 * 60 * 1000,\n      // 当前选中支付索引值\n      currentIndex: 1,\n      orderData: \"\",\n      orderId: \"\"\n    };\n  },\n  components: {\n    TopBar\n  },\n  methods: {\n    // 顶部导航栏返回按钮触发\n    backIconClick() {\n      this.$toast({\n        type: \"success\",\n        message: \"订单取消成功\"\n      });\n      this.$router.go(-2);\n    },\n    // 支付类型点击触发\n    payTypeClick(i) {\n      this.currentIndex = i;\n    },\n    // 获取订单数据\n    async getOrderData() {\n      const {\n        data\n      } = await this.$http.get(`/getOrderDataFromPay/${this.orderId}`);\n      // console.log(data);\n      this.orderData = JSON.parse(JSON.stringify(data.orderData));\n      console.log(\"订单数据\", this.orderData);\n    },\n    // 点击立即支付触发\n    async toPay() {\n      let message;\n      if (this.currentIndex == 1) {\n        message = \"微信\";\n      }\n      if (this.currentIndex == 2) {\n        message = \"支付宝\";\n      }\n      if (this.currentIndex == 3) {\n        message = \"云闪付\";\n      }\n      const result = await this.$dialog.confirm({\n        message: `您的${message}将支付${this.orderData.totalPrice}元`,\n        confirmButtonColor: \"#1989fa\"\n      }).catch(err => err);\n      if (result == \"cancel\") return;\n      this.orderData.payType = this.currentIndex;\n      // console.log(this.orderData);\n      const {\n        data\n      } = await this.$http.put(`/payOrder/${this.orderId}`, this.orderData);\n      if (data.status == \"Ok\") {\n        this.$dialog.alert({\n          title: \"提示\",\n          message: `支付成功，您的取票码为:${data.ticketCode}`,\n          theme: \"round-button\"\n        });\n        this.$router.replace(\"/home\");\n      }\n    },\n    // 倒计时结束触发\n    countDownFinish() {\n      this.$toast({\n        type: \"fail\",\n        message: \"订单支付异常\"\n      });\n      this.$router.go(-2);\n    }\n  },\n  created() {\n    this.orderId = this.$route.query.orderId;\n    this.getOrderData();\n  }\n};","map":{"version":3,"mappings":"AAkFA;AACA;EACAA;EACAC;IACA;MACA;MACAC;MACA;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;EACA;EACAC;IACA;IACAC;MACA;QACAC;QACAC;MACA;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACA;MACA;QAAAX;MAAA,yBACA,uCACA;MACA;MACA;MACAY;IACA;IACA;IACA;MACA;MACA;QACAF;MACA;MACA;QACAA;MACA;MACA;QACAA;MACA;MACA,kCACAG;QACAH;QACAI;MACA,GACAC;MACA;MACA;MACA;MACA;QAAAf;MAAA,yBACA,6BACA,eACA;MACA;QACA;UACAgB;UACAN;UACAO;QACA;QACA;MACA;IACA;IACA;IACAC;MACA;QACAT;QACAC;MACA;MACA;IACA;EACA;EACAS;IACA;IACA;EACA;AACA","names":["name","data","time","currentIndex","orderData","orderId","components","TopBar","methods","backIconClick","type","message","payTypeClick","console","confirm","confirmButtonColor","catch","title","theme","countDownFinish","created"],"sourceRoot":"src/views","sources":["OrderPay.vue"],"sourcesContent":["<template>\n  <div class=\"order-pay\">\n    <!-- 顶部栏部分 -->\n    <TopBar\n        bgc=\"#ff852e\"\n        centerContent=\"支付订单\"\n        cor=\"#FFF\"\n        @backIconClick=\"backIconClick\"\n    >\n    </TopBar>\n    <div class=\"header\">\n      <div class=\"pay-time\">\n        <div class=\"title\">支付剩余时间</div>\n        <div class=\"time\">\n          <van-count-down\n              :time=\"time\"\n              format=\"mm:ss\"\n              style=\"font-size: 1.5385rem\"\n              @finish=\"countDownFinish\"\n          >\n          </van-count-down>\n        </div>\n      </div>\n      <div class=\"pay-detail\">\n        <div class=\"pay-detail-info\">\n          <div class=\"price\" v-if=\"orderData\">\n            ￥{{ orderData.totalPrice.toFixed(2) }}\n          </div>\n          <div class=\"orderId\">\n            <span>订单编号：</span>\n            <span v-if=\"orderData\">{{ orderData.orderNum }}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"pay-type\">\n      <div class=\"pay-logo\" @click=\"payTypeClick(1)\">\n        <div class=\"left\">\n          <span class=\"iconfont icon-weixinzhifu\"></span>\n          <span>微信支付</span>\n          <div class=\"recomment\">\n            推荐\n            <div class=\"triangle\"></div>\n          </div>\n        </div>\n        <div class=\"right\">\n          <span :class=\"{ 'selected-active': currentIndex == 1 }\"\n          ><van-icon name=\"success\"\n          /></span>\n        </div>\n      </div>\n      <div class=\"pay-logo\" @click=\"payTypeClick(2)\">\n        <div class=\"left\">\n          <span class=\"iconfont icon-zhifu-_zhifubaozhifu\"></span>\n          <span>支付宝支付</span>\n        </div>\n        <div class=\"right\">\n          <span :class=\"{ 'selected-active': currentIndex == 2 }\"\n          ><van-icon name=\"success\"\n          /></span>\n        </div>\n      </div>\n      <div class=\"pay-logo\" @click=\"payTypeClick(3)\">\n        <div class=\"left\">\n          <span class=\"iconfont icon-yunshanfu\"></span>\n          <span>云闪付</span>\n        </div>\n        <div class=\"right\">\n          <span :class=\"{ 'selected-active': currentIndex == 3 }\"\n          ><van-icon name=\"success\"\n          /></span>\n        </div>\n      </div>\n    </div>\n    <!-- 底部特惠购票部分 -->\n    <div class=\"confirm-pay\" @click=\"toPay\">\n      <span>立即支付</span>\n    </div>\n  </div>\n</template>\n\n<script>\nimport TopBar from \"@/components/TopBar\";\nexport default {\n  name: \"order-pay\",\n  data() {\n    return {\n      // time: 3 * 1000,    //3秒测试用\n      time: 14 * 60 * 1000,\n      // 当前选中支付索引值\n      currentIndex: 1,\n      orderData: \"\",\n      orderId: \"\",\n    };\n  },\n  components: {\n    TopBar,\n  },\n  methods: {\n    // 顶部导航栏返回按钮触发\n    backIconClick() {\n      this.$toast({\n        type: \"success\",\n        message: \"订单取消成功\",\n      });\n      this.$router.go(-2);\n    },\n    // 支付类型点击触发\n    payTypeClick(i) {\n      this.currentIndex = i;\n    },\n    // 获取订单数据\n    async getOrderData() {\n      const { data } = await this.$http.get(\n          `/getOrderDataFromPay/${this.orderId}`\n      );\n      // console.log(data);\n      this.orderData = JSON.parse(JSON.stringify(data.orderData));\n      console.log(\"订单数据\", this.orderData);\n    },\n    // 点击立即支付触发\n    async toPay() {\n      let message;\n      if (this.currentIndex == 1) {\n        message = \"微信\";\n      }\n      if (this.currentIndex == 2) {\n        message = \"支付宝\";\n      }\n      if (this.currentIndex == 3) {\n        message = \"云闪付\";\n      }\n      const result = await this.$dialog\n          .confirm({\n            message: `您的${message}将支付${this.orderData.totalPrice}元`,\n            confirmButtonColor: \"#1989fa\",\n          })\n          .catch((err) => err);\n      if (result == \"cancel\") return;\n      this.orderData.payType = this.currentIndex;\n      // console.log(this.orderData);\n      const { data } = await this.$http.put(\n          `/payOrder/${this.orderId}`,\n          this.orderData\n      );\n      if (data.status == \"Ok\") {\n        this.$dialog.alert({\n          title: \"提示\",\n          message: `支付成功，您的取票码为:${data.ticketCode}`,\n          theme: \"round-button\",\n        });\n        this.$router.replace(\"/home\");\n      }\n    },\n    // 倒计时结束触发\n    countDownFinish() {\n      this.$toast({\n        type: \"fail\",\n        message: \"订单支付异常\",\n      });\n      this.$router.go(-2);\n    },\n  },\n  created() {\n    this.orderId = this.$route.query.orderId;\n    this.getOrderData();\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n// 外部盒子\n.order-pay {\n  width: 100vw;\n  height: 100vh;\n  background-color: #f1f1f1;\n}\n.header {\n  height: 35%;\n  background-color: #fff;\n  padding: 0 0.5385rem;\n  //text-align: center;\n  .pay-time {\n    height: 55%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    font-size: 2.3077rem;\n    letter-spacing: 1.2385rem;\n    .title {\n      //text-align: center;\n      margin-bottom: 0.7692rem;\n      font-size: 1.3385rem;\n    }\n    .time {\n      //text-align: center;\n      margin-top: 0.7692rem;\n    }\n    border-bottom: 0.2308rem dashed #ccc;\n  }\n  .pay-detail {\n    height: 55%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    font-size: 2.3077rem;\n    padding-bottom: 2rem;\n    //text-align: center;\n    //height: 45%;\n    //display: flex;\n    //align-items: center;\n    //.pay-detail-icon {\n    //  width: 25%;\n    //  font-size: 4.6154rem;\n    //  color: #fff;\n    //  span {\n    //    background-color: #ff852e;\n    //    border-radius: 0.3846rem;\n    //  }\n    //}\n    .pay-detail-info {\n      //width: 100%;\n      //margin-left: 1rem;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n      text-align: center;\n      .price {\n        font-weight: 700;\n        color: #ef5148;\n        font-size: 1.6923rem;\n        margin-bottom: 0.7692rem;\n      }\n      .orderId {\n\n        text-align: center;\n        font-size: 1.2308rem;\n        color: rgb(147, 146, 146);\n      }\n    }\n  }\n}\n.pay-type {\n  margin-top: 10px;\n  padding: 0.7692rem 1.5385rem;\n  background-color: #fff;\n  .pay-logo {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1.1538rem 0;\n    border-bottom: 1px solid rgb(221, 221, 221);\n    .left {\n      display: flex;\n      align-items: center;\n      span:nth-child(1) {\n        font-size: 2rem;\n        margin-right: 1.5385rem;\n      }\n      span:nth-child(2) {\n        font-size: 1.3846rem;\n        margin-right: 1.5385rem;\n      }\n      .recomment {\n        color: #fff;\n        background-color: #ff852e;\n        padding: 0.2308rem;\n        position: relative;\n        font-size: 0.9231rem;\n        .triangle {\n          position: absolute;\n          top: 50%;\n          transform: translateY(-50%);\n          left: -0.6923rem;\n          width: 0;\n          height: 0;\n          border-right: 0.7692rem solid #ff852e;\n          border-top: 5px solid transparent;\n          border-bottom: 5px solid transparent;\n        }\n      }\n    }\n    .right {\n      span {\n        color: #fff;\n        // font-size: 1.5385rem;\n        font-size: 1.2308rem;\n        padding: 0.3077rem;\n        border: 0.0769rem solid #ccc;\n        border-radius: 100%;\n      }\n    }\n  }\n  // 微信支付图标\n  .icon-weixinzhifu {\n    color: #00c800;\n  }\n  // 支付宝支付图标\n  .icon-zhifu-_zhifubaozhifu {\n    color: #02a9f1;\n  }\n  // 云闪付图标\n  .icon-yunshanfu {\n    color: #db261d;\n  }\n  // 选中打勾图表高亮\n  .selected-active {\n    background-color: #ff852e !important;\n    border: transparent !important;\n  }\n}\n// 底部立即支付\n// 底部TabBar\n.confirm-pay {\n  text-align: center;\n  border-radius: 0.7692rem 0.7692rem 0 0;\n  position: fixed;\n  bottom: 0;\n  background-color: #ffffff;\n  height: 4.5rem;\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  span {\n    width: 90%;\n    color: #ffffff;\n    font-size: 1.5385rem;\n    padding: 0.7692rem 0;\n    border-radius: 1.5385rem;\n    background-color: #ff852e;\n  }\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}