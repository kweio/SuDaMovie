{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport TopBar from \"@/components/TopBar.vue\";\nexport default {\n  name: \"OrderSubmit\",\n  data() {\n    return {\n      orderData: \"\",\n      //排片数据\n      orderId: \"\",\n      //订单id\n      countDownM: 14,\n      //定时分钟\n      countDownS: 59,\n      //定时秒钟\n      // countDownM: 0, //定时分钟    测试用\n      // countDownS: 3, //定时秒钟    测试用\n      timer: \"\" //setinterval接收值\n    };\n  },\n\n  components: {\n    TopBar\n  },\n  computed: {\n    countDownMM() {\n      return this.num(this.countDownM);\n    },\n    countDownSS() {\n      return this.num(this.countDownS);\n    }\n  },\n  methods: {\n    // 点击顶部返回按钮触发\n    backIconClick() {\n      this.$toast({\n        type: \"success\",\n        message: \"订单取消成功\"\n      });\n      this.$router.back();\n    },\n    // 顶部计时部分\n    // 单数补零操作\n    num(n) {\n      return n < 10 ? \"0\" + n : \"\" + n;\n    },\n    // 定时操作\n    add() {\n      this.timer = window.setInterval(() => {\n        if (this.countDownS === 0 && this.countDownM !== 0) {\n          this.countDownS = 59;\n          this.countDownM -= 1;\n        } else if (this.countDownS === 0 && this.countDownM === 0) {\n          window.clearInterval(this.timer);\n          // 这里加定时结束后要做的事\n          this.$router.back();\n          this.$toast({\n            type: \"fail\",\n            message: \"订单支付异常\"\n          });\n        } else {\n          this.countDownS -= 1;\n        }\n      }, 1000);\n    },\n    // 获取订单数据\n    async getOrderData() {\n      const {\n        data\n      } = await this.$http.get(`/getOrderDataFromSubmit/${this.orderId}`);\n      // console.log(data);\n      this.orderData = JSON.parse(JSON.stringify(data.orderData));\n      console.log(\"订单数据\", this.orderData);\n    },\n    // 点击确认支付触发\n    confirmPay() {\n      this.$router.push({\n        path: \"/orderPay\",\n        query: {\n          orderId: this.orderId\n        }\n      });\n    }\n  },\n  created() {\n    this.orderId = this.$route.query.orderId;\n    this.getOrderData();\n    this.timer && clearInterval(this.timer);\n    // 开始计时器\n    this.add();\n  },\n  beforeDestroy() {\n    // 在页面销毁前清除定时器,因为定时器有两种情况要清除，一种是刚进页面，一种是手动离开页面\n    this.timer && clearInterval(this.timer);\n  }\n};","map":{"version":3,"mappings":";AA2HA;AACA;EACAA;EACAC;IACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACA;MACA;MACAC;IACA;EACA;;EACAC;IACAC;EACA;EACAC;IACAC;MACA;IACA;IACAC;MACA;IACA;EACA;EACAC;IACA;IACAC;MACA;QACAC;QACAC;MACA;MACA;IACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACA;QACA;UACA;UACA;QACA;UACAC;UACA;UACA;UACA;YACAJ;YACAC;UACA;QACA;UACA;QACA;MACA;IACA;IACA;IACA;MACA;QAAAd;MAAA,yBACA,0CACA;MACA;MACA;MACAkB;IACA;IACA;IACAC;MACA;QACAC;QACAC;UACAnB;QACA;MACA;IACA;EACA;EACAoB;IACA;IACA;IACA;IACA;IACA;EACA;EACAC;IACA;IACA;EACA;AACA","names":["name","data","orderData","orderId","countDownM","countDownS","timer","components","TopBar","computed","countDownMM","countDownSS","methods","backIconClick","type","message","num","add","window","console","confirmPay","path","query","created","beforeDestroy"],"sourceRoot":"src/views","sources":["OrderSubmit.vue"],"sourcesContent":["<template>\n  <div class=\"order-submit\">\n    <!-- 顶部栏目部分 -->\n    <TopBar\n      bgc=\"rgb(119, 157, 176)\"\n      centerContent=\"确认订单\"\n      cor=\"#FFF\"\n      @backIconClick=\"backIconClick\"\n    >\n      <template #right>\n        <span style=\"font-size: 1.5385rem; margin-right: 0.3846rem\"\n          ><van-icon name=\"clock-o\"\n        /></span>\n        <span style=\"font-size: 1.2308rem\">\n          {{ countDownMM }}:{{ countDownSS }}</span\n        >\n      </template>\n    </TopBar>\n    <!-- 电影详情部分 -->\n    <div class=\"movie\" v-if=\"orderData\">\n      <!-- 电影图片 -->\n      <div class=\"movie-image\">\n        <img :src=\"orderData.movieId.icon\" />\n      </div>\n      <!-- 电影信息 -->\n      <div class=\"movie-detail\">\n        <!-- 电影名 -->\n        <div class=\"movie-name\">\n          <span>{{ orderData.movieId.name }}</span>\n        </div>\n        <!-- 电影类型 -->\n        <div class=\"movie-type\">\n          <span>{{ orderData.movieId.category[0].toString() }}</span>\n          <span\n            >（{{\n              orderData.movieId.language\n            }}）</span\n          >\n        </div>\n        <div class=\"movie-price\">\n          <span>票价￥{{ orderData.ticketPrice.toFixed(2) }}</span>\n          <span>{{ orderData.ticketNum }}张</span>\n        </div>\n        <div class=\"cinema-name ellipsis\">\n          <span>{{ orderData.name }}</span>\n        </div>\n        <div class=\"hall-name ellipsis\">\n          <span>{{ orderData.hallId.name }}</span>\n        </div>\n        <div class=\"movie-date\">\n          <span\n            >{{ orderData.orderDate.slice(0, 4) }}年{{\n              orderData.orderDate.slice(5, 7)\n            }}月{{ orderData.orderDate.slice(8, 10) }}日</span\n          >\n          <span>{{ orderData.orderTime }}</span>\n        </div>\n        <div class=\"positon\">\n          <div\n            v-for=\"(item, index) in orderData.seatInfo\"\n            :key=\"index\"\n            class=\"positon-content\"\n          >\n            <span>{{ item[0] + 1 }}排{{ item[1] + 1 }}座</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- 禁止信息部分 -->\n    <div class=\"forbid-info\">\n      <div class=\"box\">\n        <div>\n          <span><van-icon name=\"close\" /></span> <span>不可退票</span>\n        </div>\n        <div>\n          <span><van-icon name=\"close\" /></span> <span>不可改签</span>\n        </div>\n      </div>\n    </div>\n    <!-- 购买须知部分 -->\n    <div class=\"pay-info\">\n      <div class=\"pay-title\">\n        <h2>购票须知</h2>\n      </div>\n      <div class=\"pay-content\">\n        <p>1.请确认场次和时间无误，购买成功后将不予以退还</p>\n        <p>\n          2.由于设备故障等不可抗力因素，存在少量场次取消的情况，会进行退票退款\n        </p>\n        <p>3.由于影院系统不稳定等因素，存在出票失败的情况，会进行退款</p>\n        <p>4.购票成功后，会收到取票码</p>\n        <p>5.下单即代表你同意我们的用户服务协议</p>\n      </div>\n    </div>\n    <!-- 手机号码部分 -->\n    <div class=\"telephone\" v-if=\"orderData\">\n      <div class=\"title\"><span>手机号</span></div>\n      <div class=\"phone\">\n        <span\n          >{{ orderData.userId.phone.toString().slice(0, 3) }}****{{\n            orderData.userId.phone.toString().slice(7, 11)\n          }}</span\n        >\n      </div>\n    </div>\n    <!-- 提示部分 -->\n    <div class=\"tip\">\n      <p>提示：手机号用于生成订单，并以短信方式将取票码发送到手机上</p>\n    </div>\n    <!-- 提交部分 -->\n    <div class=\"submit\" v-if=\"orderData\">\n      <div class=\"total-prive\">\n        <span>￥</span>\n        <span>{{ orderData.totalPrice.toFixed(2) }}</span>\n      </div>\n      <div class=\"submit-btn\" @click=\"confirmPay\">\n        <span>确定支付</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport TopBar from \"@/components/TopBar.vue\";\nexport default {\n  name: \"OrderSubmit\",\n  data() {\n    return {\n      orderData: \"\", //排片数据\n      orderId: \"\", //订单id\n      countDownM: 14, //定时分钟\n      countDownS: 59, //定时秒钟\n      // countDownM: 0, //定时分钟    测试用\n      // countDownS: 3, //定时秒钟    测试用\n      timer: \"\", //setinterval接收值\n    };\n  },\n  components: {\n    TopBar,\n  },\n  computed: {\n    countDownMM() {\n      return this.num(this.countDownM);\n    },\n    countDownSS() {\n      return this.num(this.countDownS);\n    },\n  },\n  methods: {\n    // 点击顶部返回按钮触发\n    backIconClick() {\n      this.$toast({\n        type: \"success\",\n        message: \"订单取消成功\",\n      });\n      this.$router.back();\n    },\n    // 顶部计时部分\n    // 单数补零操作\n    num(n) {\n      return n < 10 ? \"0\" + n : \"\" + n;\n    },\n    // 定时操作\n    add() {\n      this.timer = window.setInterval(() => {\n        if (this.countDownS === 0 && this.countDownM !== 0) {\n          this.countDownS = 59;\n          this.countDownM -= 1;\n        } else if (this.countDownS === 0 && this.countDownM === 0) {\n          window.clearInterval(this.timer);\n          // 这里加定时结束后要做的事\n          this.$router.back();\n          this.$toast({\n            type: \"fail\",\n            message: \"订单支付异常\",\n          });\n        } else {\n          this.countDownS -= 1;\n        }\n      }, 1000);\n    },\n    // 获取订单数据\n    async getOrderData() {\n      const { data } = await this.$http.get(\n        `/getOrderDataFromSubmit/${this.orderId}`\n      );\n      // console.log(data);\n      this.orderData = JSON.parse(JSON.stringify(data.orderData));\n      console.log(\"订单数据\", this.orderData);\n    },\n    // 点击确认支付触发\n    confirmPay() {\n      this.$router.push({\n        path: \"/orderPay\",\n        query: {\n          orderId: this.orderId,\n        },\n      });\n    },\n  },\n  created() {\n    this.orderId = this.$route.query.orderId;\n    this.getOrderData();\n    this.timer && clearInterval(this.timer);\n    // 开始计时器\n    this.add();\n  },\n  beforeDestroy() {\n    // 在页面销毁前清除定时器,因为定时器有两种情况要清除，一种是刚进页面，一种是手动离开页面\n    this.timer && clearInterval(this.timer);\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n// 最外部盒子\n.order-submit {\n  display: flex;\n  flex-direction: column;\n  text-align: justify;\n  height: 100vh;\n  width: 100vw;\n  background-color: #f1f1f1;\n}\n// 电影详情部分\n.movie {\n  padding: 0.7692rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  color: #fff;\n  font-size: 1.1538rem;\n  background-color: #779db0;\n  .movie-image {\n    width: 30%;\n    img {\n      width: 9.2308rem;\n      border-radius: 0.7692rem;\n    }\n  }\n  .movie-detail {\n    height: 100%;\n    width: 60%;\n    .movie-name {\n      font-size: 1.5385rem;\n      margin-bottom: 0.7692rem;\n    }\n    .movie-type {\n      margin-bottom: 0.3846rem;\n      span:nth-child(1) {\n        margin-right: 0.3846rem;\n      }\n    }\n    .movie-price {\n      margin-bottom: 0.3846rem;\n      span:nth-child(1) {\n        margin-right: 0.7692rem;\n      }\n    }\n    .movie-date {\n      margin-bottom: 0.3846rem;\n      span:nth-child(1) {\n        margin-right: 0.7692rem;\n      }\n    }\n    .cinema-name {\n      width: 80%;\n      margin-bottom: 0.3846rem;\n    }\n    .hall-name {\n      width: 80%;\n      margin-bottom: 0.3846rem;\n    }\n    .positon {\n      width: 100%;\n      display: flex;\n      flex-wrap: wrap;\n      .positon-content {\n        width: 30%;\n        flex-wrap: wrap;\n      }\n    }\n  }\n}\n// 禁止信息部分\n.forbid-info {\n  background-color: #779db0;\n  .box {\n    color: #fff;\n    border-radius: 0.7692rem 0.7692rem 0 0;\n    font-size: 1.1538rem;\n    padding: 1.1538rem;\n    background-color: #6b8c9d;\n    display: flex;\n    div {\n      margin-right: 0.7692rem;\n    }\n  }\n}\n// 购买须知部分\n.pay-info {\n  padding: 0.7692rem;\n  background-color: #fff;\n  .pay-title {\n    margin-bottom: 0.7692rem;\n    padding-bottom: 0.3846rem;\n    border-bottom: 0.0769rem solid #ccc;\n  }\n  .pay-content {\n    color: rgb(169, 169, 169);\n    text-align: justify;\n    font-size: 1.0769rem;\n    line-height: 1.6;\n  }\n}\n// 手机号码部分\n.telephone {\n  padding: 0.7692rem;\n  border-top: 0.7692rem solid #f1f1f1;\n  background-color: #fff;\n  display: flex;\n  justify-content: space-between;\n  font-size: 1.2308rem;\n  border-bottom: 0.0769rem solid #ccc;\n}\n// 提示部分\n.tip {\n  padding: 0.7692rem;\n  background-color: #fff;\n  font-size: 0.9231rem;\n  line-height: 1.1;\n  color: rgb(255, 44, 44);\n}\n// 提交部分\n.submit {\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  padding: 0.7692rem 1.5385rem;\n  background-color: #fff;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 1.2308rem;\n  .total-prive {\n    font-weight: 700;\n    color: #ef5148;\n    span:nth-child(2) {\n      font-size: 2.3077rem;\n    }\n  }\n  .submit-btn {\n    color: #fff;\n    border-radius: 0.3846rem;\n    padding: 1.1538rem 2.3077rem;\n    background-color: #ff9900;\n  }\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}